# 10. Hangar Bay Theming Guide (Angular Material M3)

**Version:** 3.0
**Date:** 2025-06-27

## 1. The M3 Theming Paradigm: A Fundamental Shift

This project uses the **Material 3 (M3) theming system** from Angular Material (v19+). It is critical to understand that this is a **complete paradigm shift** from older (pre-v19) versions of Angular Material theming.

*   **The Old Way (Legacy & FORBIDDEN):** Used Sass mixins and functions (`mat.define-palette`, `mat.get-color-from-palette`) to compile styles at build time.
*   **The New Way (M3 & MANDATORY):** Uses a single Sass mixin (`mat.theme`) to generate a large set of CSS Custom Properties (variables) in a global stylesheet. All styling is then done in pure CSS by consuming these variables.

Failure to understand this distinction was the root cause of significant project delays. **All legacy knowledge must be discarded.**

## 2. The Single Source of Truth: `theme.scss`

The single source of truth for all color, typography, and elevation values in this application is:

`app/frontend/angular/src/theme.scss`

This file is generated by the Angular Material M3 schematic. It contains the complete set of M3 system tokens as CSS variables (e.g., `var(--md-sys-color-primary)`, `var(--mat-sys-typescale-headline-large-font)`).

**This file is the only place where theme values are defined.**

## 3. The Core Rules of M3 Theming
These rules are mandatory and non-negotiable.

*   **1. Use CSS Variables Exclusively:** All color, typography, and elevation values **MUST** come from CSS variables defined in `theme.scss` (e.g., `var(--md-sys-color-primary)`). Hardcoded values (hex, rgb, color names) are strictly forbidden.
*   **2. Style with Semantic Intent:** Always choose variables based on their semantic purpose (e.g., `primary` for key actions, `surface` for backgrounds, `error` for warnings), not just their appearance. The reference tables below provide the specific use cases for each role.
*   **3. Ensure Accessibility with "On" Colors:** For any element with a background color (e.g., `background-color: var(--md-sys-color-primary)`), the text and icons on it **MUST** use the corresponding `on-` color (e.g., `color: var(--md-sys-color-on-primary)`).
*   **4. Avoid All Legacy APIs:** All legacy Angular Material Sass mixins and functions (e.g., `mat.define-palette`, `mat.get-color-from-palette`) are strictly forbidden. This is the most critical rule to prevent repeating past mistakes.
*   **5. Do Not Use `::ng-deep`:** The `::ng-deep` shadow-piercing combinator is forbidden for theming. Component styles should be properly encapsulated.

## 4. Color Role Reference
This section provides a quick reference for the most common semantic roles.

#### Main Color Roles

| Role      | CSS Variable                | Purpose & Use Cases                                                                                                                   |
| :-------- | :-------------------------- | :------------------------------------------------------------------------------------------------------------------------------------ |
| Primary   | `--md-sys-color-primary`    | The most prominent color. Used for key actions like primary buttons, the icon color of selected navigation items, and the outline of focused form fields. |
| Secondary | `--md-sys-color-secondary`  | Used for less prominent components that still need emphasis, like filter chips.                                                       |
| Tertiary  | `--md-sys-color-tertiary`   | Used for contrasting accents that can balance primary and secondary colors. Think of it for highlighting secondary information.        |
| Error     | `--md-sys-color-error`      | Exclusively for indicating errors, such as in invalid form fields or error notifications.                                                |

#### "On" Colors for Accessibility

For every main color, there is a corresponding `on-` color. Using this for text/icons on that color's background is **mandatory for accessibility**.

| Role         | CSS Variable                     | Purpose                                                                 |
| :----------- | :------------------------------- | :---------------------------------------------------------------------- |
| On Primary   | `--md-sys-color-on-primary`      | Use for text and icons placed on top of a `--md-sys-color-primary` background.   |
| On Secondary | `--md-sys-color-on-secondary`    | Use for text and icons placed on top of a `--md-sys-color-secondary` background. |

#### Surface & Container Colors

These are the backbone of the UI's background and layout.

| Role                 | CSS Variable                            | Purpose                                                                                                                              |
| :------------------- | :-------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------- |
| Surface              | `--md-sys-color-surface`                | The main background color for components like dialogs, cards, and menus.                                                             |
| On Surface           | `--md-sys-color-on-surface`             | The primary text color for content on a surface background.                                                                          |
| On Surface Variant   | `--md-sys-color-on-surface-variant`     | A lower-emphasis text color for secondary text or hints on a surface background.                                                     |
| Surface Container    | `--md-sys-color-surface-container`      | A subtle background color, slightly different from the main surface, to create visual hierarchy. The guide shows `Lowest`, `Low`, `High`, and `Highest` variants to create different levels of elevation. |
| Outline              | `--md-sys-color-outline`                | The primary color for borders, dividers, and decorative outlines.                                                                    |

## 5. Putting It All Together: A Practical Example

Let's look at a practical example. We have a custom `info-card` component that needs a background color, a border, and text styling.

**`info-card.scss`**
```scss
:host {
  display: block;
  // Use a surface color for the background.
  // 'surface-container-high' is slightly lighter than the main background.
  background-color: var(--md-sys-color-surface-container-high);
  // Use the 'outline' color for borders.
  border: 1px solid var(--md-sys-color-outline);
  border-radius: 8px;
  padding: 16px;
}

.info-card-title {
  // Use a typescale token for typography.
  font: var(--md-sys-typescale-title-large);
  // Use the corresponding 'on-surface' color for text to ensure contrast.
  color: var(--md-sys-color-on-surface);
}

.info-card-body {
  // Apply the 'body-medium' typography style
  font: var(--md-sys-typescale-body-medium);
  // Use the secondary text color for less emphasis
  color: var(--md-sys-color-on-surface-variant);
}
```

## 6. Pre-Commit Theming Checklist

Before finalizing any styling changes, you **MUST** verify your code against this checklist.

- [ ] **No Hardcoded Colors:** I have used a CSS variable (`var(...)`) for every color value, avoiding all hex codes, rgb values, and Sass color names.
- [ ] **Correct Semantic Role:** The chosen color variable (e.g., `primary`, `surface-container`, `outline`) semantically matches the UI element's purpose.
- [ ] **Accessibility Check ("On" Colors):** For every `background-color`, its corresponding `color` uses the correct `on-` variable (e.g., `color: var(--md-sys-color-on-primary)` on a `background-color: var(--md-sys-color-primary)`).
- [ ] **No Legacy APIs:** My changes do not include any legacy Sass (`@use`, `@include`, `mat.get-color-from-palette`) or `::ng-deep` for theming.
- [ ] **Source of Truth:** I have confirmed that every CSS variable I used exists in `src/app/theme.scss`.

---

## 7. Generating & Updating the Theme

The `theme.scss` file was generated using the official Angular Material schematic. To regenerate it (for instance, to change the primary color), run the following command from the `app/frontend/angular/` directory:

```bash
# This example uses our project's primary color: #632ebd
ng generate @angular/material:m3-theme --name theme --project hangar-bay-frontend --primary-color "#632ebd"
```

This will overwrite the existing `src/theme.scss` with a new dark theme based on the provided color.
