---
Phase: 03 - Frontend Core Infrastructure
TaskID: 03.3
ExecutionSequence: 4
PreviousTask: ./03.2-backend-api-service-layer.md
NextTask: ../phase-04-frontend-f001-f002-contract-listing-basic-filtering/04.1-contract-list-component.md
ParentPlan: ../00-mvp-implementation-plan-overview.md
LastUpdated: 2025-06-10
---

# Task 03.3: Basic Layout, Zoneless Routing, and Navigation

## 1. Objective

To establish the basic application layout using standalone `HeaderComponent` and `FooterComponent`. This task focuses on configuring the Angular application for **zoneless** change detection and setting up the initial routing structure using modern, standalone APIs. The outcome will be a functional shell with a header, a footer, and a content area where feature components can be rendered.

## 2. Relevant Specifications

*   `/design/angular/00-angular-architecture-overview.md` (Primary architectural source of truth)
*   `/design/angular/guides/01-standalone-components.md`
*   `/design/angular/guides/06-routing-and-navigation.md`
*   `/design/angular/patterns/02-standalone-routed-component.md`
*   `/design/angular/patterns/03-lazy-loaded-routes.md`
*   `/design/angular/guides/08-performance-and-change-detection.md` (Specifically the **Zoneless** section)

## 3. Key Implementation Steps

*   [ ] **Create Standalone Layout Components:**
    *   Generate standalone components for common layout elements (assuming component prefix `hgb` from Task 03.1):
        *   `ng generate component core/layout/header --standalone`
        *   `ng generate component core/layout/footer --standalone`
    *   **Component Best Practices:**
        *   Confirm `ChangeDetectionStrategy.OnPush` is set by default in the generated components.
        *   Use Angular Signals for any internal state (e.g., mobile menu visibility).
        *   Use the `inject()` function for dependency injection (e.g., `const router = inject(Router);`).

*   [ ] **Configure Standalone `AppComponent`:**
    *   Ensure the main `AppComponent` (`app.component.ts`) is standalone (`standalone: true`).
    *   In `app.component.ts`, import the layout components and `RouterOutlet` directly into the component's `imports` array:
        ```typescript
        import { HeaderComponent } from './core/layout/header/header.component';
        import { FooterComponent } from './core/layout/footer/footer.component';
        import { RouterOutlet } from '@angular/router';

        @Component({
          selector: 'hgb-root',
          standalone: true,
          imports: [HeaderComponent, FooterComponent, RouterOutlet],
          templateUrl: './app.component.html',
          styleUrls: ['./app.component.scss'],
          changeDetection: ChangeDetectionStrategy.OnPush
        })
        export class AppComponent { ... }
        ```
    *   Update `app.component.html` to use these components and a `<router-outlet>`:
        ```html
        <hgb-header />
        <main>
          <router-outlet />
        </main>
        <hgb-footer />
        ```

*   [ ] **Define Routes and Configure Zoneless Bootstrap:**
    *   **Create Placeholder Components:**
        *   Generate a standalone placeholder for the home page: `ng generate component core/home/home-page --standalone`
        *   Generate a standalone placeholder for the contracts list feature: `ng generate component features/contracts/contract-list-page --standalone`.
    *   **Create Feature Routes File:**
        *   Create a feature-level routes file: `src/app/features/contracts/contracts.routes.ts`.
        *   Define the route within this new file:
            ```typescript
            import { Routes } from '@angular/router';
            import { ContractListPageComponent } from './contract-list-page/contract-list-page.component';

            export const CONTRACTS_ROUTES: Routes = [
              { path: '', component: ContractListPageComponent }
            ];
            ```
    *   **Configure `app.routes.ts` for Foundational Routing:**
        *   In the main `app.routes.ts`, configure the root home route and the lazy-loaded `contracts` route:
            ```typescript
            import { Routes } from '@angular/router';
            import { HomePageComponent } from './core/home/home-page/home-page.component';

            export const routes: Routes = [
              { path: '', component: HomePageComponent },
              { 
                path: 'contracts', 
                loadChildren: () => import('./features/contracts/contracts.routes').then(r => r.CONTRACTS_ROUTES)
              },
              // { path: '**', component: PageNotFoundComponent } // Optional: Add later
            ];
            ```
    *   **Configure `app.config.ts` for Zoneless Routing:**
        *   Update `app.config.ts` to use `provideRouter` and enable zoneless change detection.
            ```typescript
            import { ApplicationConfig, provideZoneChangeDetection } from '@angular/core';
            import { provideRouter, withComponentInputBinding, withViewTransitions } from '@angular/router';
            import { routes } from './app.routes';

            export const appConfig: ApplicationConfig = {
              providers: [
                provideZoneChangeDetection({ ngZone: 'noop' }), // Key for Zoneless!
                provideRouter(
                  routes,
                  withComponentInputBinding(), // Recommended for modern component patterns
                  withViewTransitions()      // Enables smooth route transitions
                )
              ]
            };
            ```

*   [ ] **Implement Basic Navigation:**
    *   In `header.component.html`, add navigation links for Home and Contracts. Use `routerLinkActive` to style the active link and mark text for translation with `i18n`.
        ```html
        <nav>
          <a routerLink="/" routerLinkActive="active-link" [routerLinkActiveOptions]="{exact: true}" i18n>Home</a>
          <a routerLink="/contracts" routerLinkActive="active-link" i18n>Contracts</a>
        </nav>
        ```
    *   Ensure `RouterLink` and `RouterLinkActive` are imported in `header.component.ts`'s `imports` array. Note the use of `[routerLinkActiveOptions]="{exact: true}"` to prevent the root link from staying active on child routes.

*   [ ] **Remove `zone.js`:**
    *   Once the application is bootstrapping correctly in zoneless mode, open `angular.json`.
    *   Find the `polyfills` array and remove the entry for `zone.js`.

## 4. AI Implementation Guidance

*   **Embrace Standalone:** All generated components, directives, and pipes should use the `--standalone` flag. Avoid NgModules entirely for new features.
*   **Zoneless is Default:** The `provideZoneChangeDetection({ ngZone: 'noop' })` in `app.config.ts` is the foundation of our performance strategy. All change detection will be managed manually via signals or the `async` pipe.
*   **Routing with `loadChildren`:** Use `loadChildren` with a dynamic `import()` to a `.routes.ts` file for lazy loading. This is the modern, NgModule-less approach.
*   **Lazy Loading by Default:** Always prefer `loadChildren` for feature areas to ensure the initial bundle remains small.
*   **Component Imports:** In a standalone architecture, components manage their own dependencies. Any components, directives, or pipes used in a template must be added to that component's `imports` array. For example, to use `*ngIf`, import `CommonModule`; to use `routerLink`, import `RouterLink`.
*   **File Organization:** Keep route definitions (`*.routes.ts`) separate from components for clarity.
*   **Styling:** Use encapsulated component styles (`.scss`) for component-specific rules. Use the global `styles.scss` for foundational styles like CSS resets, typography, and theme variables.

## 5. Definition of Done

*   [ ] `HeaderComponent` and `FooterComponent` are created as standalone components.
*   [ ] `AppComponent` is standalone and correctly imports and displays the layout components and `<router-outlet>`.
*   [ ] The application is configured for zoneless change detection via `provideZoneChangeDetection({ ngZone: 'noop' })`.
*   [ ] A basic routing configuration exists in `app.routes.ts` with a default path.
*   [ ] A lazy-loaded route for a placeholder `contracts` feature is defined.
*   [ ] A routing integration test exists and passes, verifying that navigation works as expected.
*   [ ] `zone.js` has been removed from the project's polyfills in `angular.json`.
*   [ ] All new files and code changes are committed to version control.

## 6. Challenges & Resolutions

*   (Placeholder for any challenges encountered and their resolutions during this task.)

## 7. Cross-Cutting Concerns Review

This section documents how the five key cross-cutting concerns were addressed during the completion of this task. Refer to the primary specification documents for detailed guidance:
*   Security: `/design/specifications/security-spec.md`
*   Observability: `/design/specifications/observability-spec.md`
*   Testing: `/design/specifications/test-spec.md`
*   Accessibility: `/design/specifications/accessibility-spec.md`
*   Internationalization (i18n): `/design/specifications/i18n-spec.md`

### 7.1. Security
*   [x] **Secure Design:** N/A for basic layout structure.
*   [x] **Input Validation:** N/A for static layout components.
*   [x] **Output Encoding:** Angular's standalone components and templates provide default XSS protection.
*   [x] **Authentication/Authorization:** N/A for public routes.
*   [x] **Secrets Management:** N/A.
*   [x] **Dependency Management:** No new *external* dependencies. Angular's router is a core dependency.
*   **Notes:** Using `routerLink` for internal navigation is a security best practice upheld by this plan. Do not use `href` for internal routes to prevent full page reloads and leverage Angular router security features. All checklist items are marked `[x]` as they have been considered and deemed either addressed by the framework or Not Applicable for this specific task.

### 7.2. Observability
*   [x] **Structured Logging:** N/A for this task.
*   [x] **Key Events Logged:** Angular Router events can be subscribed to later for analytics if needed. This task does not implement logging.
*   [x] **Error Logging:** Will be handled by a global error handler to be defined in a later task.
*   [x] **Correlation IDs:** N/A.
*   [x] **Metrics:** N/A.
*   **Notes:** No specific observability actions are implemented in this task. Future work could involve logging route change events for analytics. All checklist items are marked `[x]` as they have been considered and deemed either Not Applicable or deferred.

### 7.3. Testing
*   [x] **Unit Tests:** Basic `.spec.ts` files for `HeaderComponent` and `FooterComponent` will be created to verify they render.
*   [x] **Integration Tests:** An integration test for `AppComponent` will verify that the layout components and `<router-outlet>` are present. A specific integration test will be created to verify a lazy-loaded route (e.g., 'contracts') can be successfully activated. This mitigates the risk of runtime errors due to incorrect `loadChildren` paths.
*   [x] **Test Coverage:** Aim for reasonable unit and integration test coverage on the created components and routing configuration.
*   [x] **Test Data Management:** N/A.
*   **Notes:** Adhere to `/design/specifications/test-spec.md`. The addition of a routing integration test directly addresses risks identified in the pre-mortem review.

### 7.4. Accessibility (A11y)
*   [x] **Semantic HTML:** The plan specifies using semantic elements like `<nav>`, `<main>`, `<header>`, and `<footer>` to provide a clear document structure for assistive technologies. `AppComponent` will orchestrate this structure.
*   [x] **Keyboard Navigation:** Use of the `routerLink` directive ensures that navigation elements are keyboard-accessible by default, behaving like standard `<a>` tags.
*   [x] **ARIA Roles/Attributes:** The plan implies the use of appropriate roles (e.g., `banner`, `contentinfo`, `navigation`) within the layout components, aligning with accessibility best practices.
*   [x] **Focus Management:** Default focus management will be handled by the Angular router. More complex focus strategies are deferred to tasks involving more interactive components.
*   [x] **Color Contrast:** N/A for this task, as it involves structure, not styling.
*   **Notes:** The fundamental layout structure is designed to be accessible. Future components will build on this foundation. All checklist items are marked `[x]` as they have been considered.

### 7.5. Internationalization (I18n)
*   [ ] **Text Extraction:** All user-facing, static text in the layout components (e.g., navigation links, footer text) must be marked with the `i18n` attribute for extraction. The plan establishes the *practice* of marking text for i18n from the very beginning.
*   [x] **Locale-Specific Formatting:** N/A for static text.
*   [x] **Directionality (LTR/RTL):** N/A for this initial layout.
*   [X] **UI Layout Adaptability:** N/A for this task.
*   [x] **Character Encoding:** UTF-8 is enforced by the project setup.
*   **Notes:** Adhering to `/design/specifications/i18n-spec.md`, this task establishes the i18n-first pattern for all future UI development by marking all text in the initial layout components.