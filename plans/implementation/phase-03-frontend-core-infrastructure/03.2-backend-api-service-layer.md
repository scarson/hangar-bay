# Task 03.2: Backend API Service Layer

**Phase:** 03 - Frontend Core Infrastructure
**Parent Plan:** [MVP Implementation Plan Overview](../00-mvp-implementation-plan-overview.md)
**Last Updated:** 2025-06-06

## 1. Objective

To create a dedicated Angular service (or services) responsible for communicating with the backend FastAPI. This includes setting up `HttpClientModule`, defining base API URL from environment configuration, and creating initial methods for fetching data.

## 2. Relevant Specifications

*   `../../../design/design-spec.md` (Sections: Frontend Architecture, API Communication)
*   Task 00.2: Configuration Management (Angular `environment.ts` for `apiUrl`)
*   Task 02.4: API Endpoints for F001 (Backend endpoints to call)

## 3. Key Implementation Steps

*   [ ] **Import `HttpClientModule`:**
    *   Import `HttpClientModule` into the root `AppModule` (or a relevant shared module).
    *   **AI Prompt:** "Show how to import `HttpClientModule` into an Angular `AppModule`."
*   [ ] **Create API Service(s):**
    *   Generate a new Angular service using the CLI (e.g., `ng generate service core/services/api` or `ng g s features/contracts/contract-api`).
    *   Inject `HttpClient` into the service.
*   [ ] **Configure Base API URL:**
    *   Utilize the `apiUrl` from Angular's environment files (`src/environments/environment.ts`) to prefix API calls.
    *   Ensure `environment.ts` and `environment.prod.ts` have the correct `apiUrl` for local development and production.
*   [ ] **Implement Initial API Methods:**
    *   Based on backend API endpoints from Task 02.4 (e.g., fetching contracts), create methods in the service.
    *   Define TypeScript interfaces/types for expected API request parameters and response data structures (can be based on backend Pydantic schemas from Task 02.4).
    *   Example: `getContracts(params: ContractRequestParams): Observable<PaginatedContractsResponse>`
    *   **AI Prompt:** "Generate an Angular service method `getContracts` that uses `HttpClient` to make a GET request to `[apiUrl]/contracts`. It should accept an object for query parameters (e.g., page, size, region_id) and return an `Observable` of a defined TypeScript interface representing the paginated contract data."
*   [ ] **Error Handling Strategy (Initial):**
    *   Consider a basic error handling approach for API calls (e.g., using RxJS `catchError` operator) to log errors or transform them for UI display. A more robust global error handler can be implemented later.

## 4. AI Implementation Guidance

*   Use strong typing for API request and response objects.
*   Leverage RxJS operators for handling asynchronous data streams from `HttpClient`.
*   Keep API services focused; consider separate services for different resource types if the API grows complex.
*   Ensure the `apiUrl` is correctly sourced from environment files.

## 5. Definition of Done

*   `HttpClientModule` is imported and available.
*   An Angular service for backend communication is created.
*   The service uses `apiUrl` from environment files.
*   Initial methods for fetching contract data (as per F001 backend API) are implemented with appropriate TypeScript types.
*   Basic error handling consideration is in place for API calls.
*   All new files and code changes are committed to version control.
