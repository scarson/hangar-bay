---
Phase: 04 - Frontend F001-F002 Contract Listing & Basic Filtering
TaskID: 04.4
ExecutionSequence: 4
PreviousTask: ./04.3-basic-filtering-ui.md
NextTask: ./04.5-final-review-and-cleanup.md
ParentPlan: ../00-mvp-implementation-plan-overview.md
LastUpdated: 2025-06-25
---

# Task 04.4: Implement Advanced Filtering and Sorting

## 1. Objective

To enhance the contract browsing experience by adding sorting capabilities (e.g., by price, date issued). This involves updating the data model, extending the state management service to handle sort parameters, and adding UI controls to the table headers to trigger sorting, making the data table much more interactive and user-friendly.

## 2. Relevant Specifications

*   `design/features/f002-contract-filtering.md`
*   `design/architecture/angular-frontend-architecture.md`
*   `app/frontend/angular/src/app/features/contracts/contract-search.ts` (for existing pattern)

## 3. Key Implementation Steps

### 3.1. Data Model (`contract.models.ts`)

*   [ ] **Step 1.1:** Extend the `ContractSearchFilters` interface to include optional `sort?: string` and `order?: 'asc' | 'desc'` properties.
    *   **AI Prompt:** "In `contract.models.ts`, add two new optional properties to the `ContractSearchFilters` interface: `sort?: string;` and `order?: 'asc' | 'desc';`."

### 3.2. State Management Service (`contract-search.ts`)

*   [ ] **Step 2.1:** Update the RxJS pipeline to include `sort` and `order` in the `HttpParams` if they exist.
    *   **AI Prompt:** "In `contract-search.ts`, modify the `switchMap` operator. If `filters.sort` and `filters.order` exist, add them as query parameters to the `HttpParams`."

### 3.3. Component UI (`contract-browse-page.html`)

*   [ ] **Step 3.1:** Make the table headers (`<th>`) for sortable columns clickable.
*   [ ] **Step 3.2:** Add a `(click)` event binding to these headers to call a new sorting method.
*   [ ] **Step 3.3:** Add visual indicators (e.g., an icon or class) to the active sort column to show the sort direction (ascending/descending).

### 3.4. Component Logic (`contract-browse-page.ts`)

*   [ ] **Step 4.1:** Create a new method `onSort(sortKey: string)`.
*   [ ] **Step 4.2:** This method should check the current sort key and direction. If the same key is clicked, it should toggle the direction (`asc` -> `desc`). If a new key is clicked, it should default to `asc`.
*   [ ] **Step 4.3:** Call `this.contractSearch.updateFilters()` with the new `sort` and `order` parameters, and reset the page to 1.

### 3.5. Testing

*   [ ] **Step 5.1:** In `contract-search.spec.ts`, add a test to verify that calling `updateFilters` with `sort` and `order` adds the correct query parameters to the API call.
*   [ ] **Step 5.2:** In `contract-filter-resolver.spec.ts`, update the tests to handle `sort` and `order` query parameters being passed in the URL.
*   [ ] **Step 5.3:** In `contract-browse-page.spec.ts`, add a test to simulate clicking a table header and verify that the correct call to `updateFilters` is made.

## 4. AI Implementation Guidance

*   Follow the existing signal-based state management pattern.
*   Ensure the sorting UI provides clear visual feedback (e.g., an arrow icon next to the column header) to the user about the current sort state.
*   When a new sort is applied, always reset the page to 1.

## 5. Definition of Done (DoD)

*   [ ] **Implementation Complete:** All placeholder and scaffold code has been replaced with the final, working logic.
*   [ ] The `ContractSearchFilters` interface now includes `sort` and `order` properties.
*   [ ] The `ContractSearch` service correctly adds the sort parameters to the API request.
*   [ ] The `ContractBrowsePage` table headers are clickable and trigger sorting.
*   [ ] The UI visually indicates the currently sorted column and direction.
*   [ ] Unit tests for all new sorting logic are implemented and passing.
*   [ ] All related items in the 'Cross-Cutting Concerns Review' section are addressed.

## 6. Challenges & Resolutions

*   (Placeholder for any challenges encountered and their resolutions during this task.)

## 7. Cross-Cutting Concerns Review

This section documents how the five key cross-cutting concerns were addressed during the completion of this task.

### 7.1. Security
*   [x] **Secure Design:** N/A. UI-only task with predefined sort keys.
*   **Notes:** No new security implications.

### 7.2. Observability
*   [x] **Key Events Logged:** N/A.
*   **Notes:** No new logic that would require observability.

### 7.3. Testing
*   [ ] **Unit Tests:** Unit tests must be added for the new logic in the service, resolver, and component.
*   [ ] **Integration Tests:** Existing tests will be updated to cover UI interactions.
*   **Notes:** Testing is a critical part of this task.

### 7.4. Accessibility (A11y)
*   [ ] **Semantic HTML/Structure:** Clickable headers should be implemented as `<button>` elements inside the `<th>` for proper semantics and keyboard accessibility.
*   [ ] **ARIA Attributes:** Use `aria-sort` (`ascending`, `descending`, `none`) on the `<th>` elements to indicate the sort state to screen readers.
*   **Notes:** Ensure the sorting controls are fully accessible.

### 7.5. Internationalization (I18n)
*   [ ] **Text Abstraction:** Any new tooltips or text for sorting indicators must be marked with `i18n` attributes.
*   **Notes:** No new user-facing text is anticipated, but if any is added, it must be internationalized.
