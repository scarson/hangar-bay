# Task 02.4: API Endpoints for F001

**Phase:** 02 - Backend - F001: Public Contract Aggregation
**Parent Plan:** [MVP Implementation Plan Overview](../00-mvp-implementation-plan-overview.md)
**Last Updated:** 2025-06-06

## 1. Objective

To develop FastAPI API endpoints that allow the frontend to query and retrieve aggregated public contract data stored in the local database, supporting basic filtering and pagination as required by F001.

## 2. Relevant Specifications

*   `../../../design/design-spec.md` (Sections: API Design Principles, Backend Architecture)
*   `../../../design/features/F001-Public-Contract-Aggregation-Display.md` (API endpoint requirements, filtering parameters)
*   Task 02.2: Data Models for F001 (for response schemas)
*   Task 01.2: Database Setup (for `get_db` dependency)

## 3. Key Implementation Steps

*   [ ] **Define Pydantic Schemas for API Responses:**
    *   Create `app/schemas/contract.py` (or similar).
    *   Define Pydantic models for API responses (e.g., `ContractRead`, `ContractItemRead`). These should derive from the data fields needed by the frontend, potentially excluding some internal model fields.
    *   Include schemas for paginated responses (e.g., a generic `Page[T]` schema).
    *   **AI Prompt:** "Generate Pydantic schemas `ContractItemRead` and `ContractRead` (which includes a list of `ContractItemRead`). `ContractRead` should include fields like `contract_id`, `issuer_id`, `type`, `status`, `date_issued`, `price`, `items`. Also, create a generic Pydantic schema `Page[T]` for pagination, including `items: list[T]`, `total: int`, `page: int`, `size: int`."
*   [ ] **Implement Contract List Endpoint (e.g., `/api/v1/contracts`):**
    *   Create `app/api/v1/endpoints/contracts.py`.
    *   Implement a GET endpoint to list contracts.
    *   Support query parameters for basic filtering (e.g., `region_id`, `contract_type`, `status`).
    *   Implement pagination (e.g., `page`, `size` query parameters).
    *   Use SQLAlchemy to query the database based on filters and pagination.
    *   Return data using the defined Pydantic response schemas.
    *   **AI Prompt:** "Generate a FastAPI GET endpoint `/api/v1/contracts` that uses SQLAlchemy to query `Contract` models. It should support optional query parameters for `region_id` (int) and `contract_type` (str), and pagination parameters `page` (int, default 1) and `size` (int, default 20). Return data using the `Page[ContractRead]` schema."
*   [ ] **(Optional) Implement Single Contract Detail Endpoint (e.g., `/api/v1/contracts/{contract_id}`):**
    *   While F003 covers detailed views, a basic endpoint to fetch a single contract by ID might be useful here if F001 display implies clicking for more details not covered by the list view itself. For MVP, this might be deferred to F003 tasks.
    *   **Decision:** Defer to Phase 07 for F003.
*   [ ] **API Router Integration:**
    *   Create an API router in `app/api/v1/api.py` and include the contracts router.
    *   Mount this main v1 router in `app/main.py`.
*   [ ] **Input Validation:**
    *   Rely on FastAPI's automatic validation for query parameters and Pydantic for request bodies (if any).

## 4. AI Implementation Guidance

*   Use FastAPI's `Depends` for database sessions (`get_db`).
*   Structure API endpoints logically using APIRouters.
*   Ensure Pydantic schemas accurately reflect the data to be exposed to the client.
*   Implement efficient database queries, especially for filtering and pagination.
*   Follow RESTful principles for API design.

## 5. Definition of Done

*   Pydantic schemas for API responses are defined.
*   A GET endpoint to list contracts with basic filtering and pagination is implemented and functional.
*   The endpoint is integrated into the FastAPI application via an API router.
*   The API is tested locally (e.g., using Swagger UI or `curl`).
*   All new files and code changes are committed to version control.
